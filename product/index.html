<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Product</title>
	<link rel="stylesheet" href="../style.css" />
	<link rel="stylesheet" href="productList.css" />

</head>
<body>
	<nav class="navbar">
	    <div class="nav-container">
	        <div class="logo">
	            <a href="https://mofom.net">MOFOM INC</a>
	        </div>
	        <ul class="nav-menu">
	            <li class="nav-item">
	                <a href="../index.html" class="nav-link">Home</a>
	            </li>
	            <li class="nav-item">
	                <a href="#" class="nav-link active">Product</a>
	            </li>
	            <li class="nav-item">
	                <a href="../help.html" class="nav-link">Help</a>
	            </li>
	            <!-- <li class="nav-item">
	                <a href="temp.html" class="nav-link"></a>
	            </li> -->
	        </ul>
	        <div class="hamburger">
	            <span class="bar"></span>
	            <span class="bar"></span>
	            <span class="bar"></span>
	        </div>
	    </div>
	</nav>
	
	<h1 style="margin-left: 20px;">What do you want?</h1>
	<div id="list-container">
		
	</div>
	<footer class="footer">
	    <div class="container">
	        <div class="footer-content">
	            <div class="footer-section">
	                <h3>MOFOM Inc, CA, USA</h3>
	                <p></p>
	            </div>
	            <div class="footer-section">
	                <h4>contact us</h4>
	                
					
	                <p>EMAIL: info@mofom.net</p>
	            </div>
	            <!-- <div class="footer-section">
	                <h4>View our other products</h4>
	                <div class="social-links">
	                    <a href="http://www.shenghua.com.cn/">北京市升华电梯集团</a>
	                </div>
	            </div> -->
	        </div>
	        <div class="footer-bottom">
	            <p>Copyright&copy; 2025 MOFOM Inc. all rights reserved.</p>
	        </div>
	    </div>
	</footer>

	<script src="../script.js"></script>
	<script>
		function goToDetailPage(itemId) {
		    if (typeof itemId !== 'number') {
		        console.error('it must be a number');
		        return;
		    }
		
		    // 构造跳转 URL，传递参数 itemId
		    const targetUrl = `detail.html?id=${itemId}`;
		
		    // 执行跳转
		    window.location.href = targetUrl;
		}
		// 按顺序加载 ./main.json 中列出的文件，并返回对象数组
		async function loadSequentialData() {
		    const baseUrl = './productData';
		    const result = [];
		
		    try {
		        // 第一步：加载 main.json 获取文件列表
		        const mainResponse = await fetch(`${baseUrl}/main.json`);
		        if (!mainResponse.ok) {
		            throw new Error(`cannot load main.json: HTTP ${mainResponse.status}`);
		        }
		
		        const mainData = await mainResponse.json();
		        const fileList = mainData.files || [];
		
		        if (fileList.length === 0) {
		            throw new Error('main.json does not have a list in it');
		        }
		
		        console.log(`${fileList.length} files in list`, fileList);
		
		        for (const filename of fileList) {
		            try {
		                const response = await fetch(`${baseUrl}/${filename}`);
		                if (!response.ok) {
		                    throw new Error(`load failed: ${filename}, HTTP ${response.status}`);
		                }
		
		                const data = await response.json();
		                result.push(data);
		                // console.log(`成功加载: ${filename}`);
		            } catch (fileError) {
		                console.warn(`skip ${filename}:`, fileError);
		            }
		        }
		        return result;
		
		    } catch (error) {
		        console.error(error);
		        return [];
		    }
		}
		async function render_data_to_screen() {
		    const productlist = document.getElementById("list-container");
		    const result = await loadSequentialData();
		
		    // document.getElementById("result").textContent = JSON.stringify(result, null, 2);
		    console.log(result);
		
		    let content = "";
		    for (let i = 0; i < result.length; i++) {
		        let title = result[i].title;
		        let description = result[i].description;
		        let displayImageUrl = result[i].imagesUrl[0];
		        let imagesRemain = result[i].imagesUrl.length - 1;
		        let isDiscount = result[i].discount.isDiscount;
		        let discountRate = result[i].discount.rate;
		        let discountUntil = result[i].discount.until;
				let discountTitle = result[i].discount.discountTitle;
				
				let discountMsg = "DISCOUNT MESSAGE ERROR";
				
				if(discountTitle == undefined || discountTitle == '') {
					discountMsg = `${discountRate}% Off until ${discountUntil}`;
				} else {
					discountMsg = `${discountTitle}`;
				}
		
		        content += `
		            <div class="list-item"  onclick="goToDetailPage(${i})">
		              <div class="discount-badge ${(isDiscount == 0 ? "hidden" : "")}">${discountMsg}</div>
		              <div class="image-count-badge ${(imagesRemain === 0 ? "hidden" : "")}">+${imagesRemain}</div>
		              <img src="${displayImageUrl}" alt="" />
		              <div class="list-item-description">
		                <h1>${title}</h1>
		                <p>${description}</p>
		              </div>
		            </div>
		        `;
		    }
		    productlist.innerHTML = content;
		}
		document.addEventListener("DOMContentLoaded", render_data_to_screen());
	</script>
</body>

</html>

