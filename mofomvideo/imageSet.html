<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Image Viewer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      height: 100%;
      min-height: 100vh;
      background: #f5f5f5;
      overflow-x: hidden;
      /* é˜²æ­¢ä»»ä½•æ»šåŠ¨ */
      overflow-y: hidden;
    }
    
    /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
    .sidebar {
      width: 320px;
      background: white;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      /* é˜²æ­¢ä¾§è¾¹æ æ»šåŠ¨ */
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .sidebar h1 {
      font-size: 24px;
      color: #333;
      margin-bottom: 8px;
    }
    
    .sidebar label {
      font-size: 14px;
      color: #666;
      font-weight: 500;
      margin-bottom: 8px;
      display: block;
    }
    
    /* ä¸‹æ‹‰é€‰æ‹©å™¨å®¹å™¨ */
    .select-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      list-style: none;
    }
    
    select {
      width: 100%;
      padding: 10px 35px 10px 12px;
      font-size: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background-color: #fff;
      color: #333;
      cursor: pointer;
      transition: all 0.2s;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg fill='%23666' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 16px;
    }
    
    select:hover {
      border-color: #0078d4;
    }
    
    select:focus {
      border-color: #0078d4;
      box-shadow: 0 0 0 3px rgba(0,120,212,0.1);
      outline: none;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    .btn {
      padding: 12px 24px;
      font-size: 15px;
      font-weight: 500;
      border: 2px solid #0078d4;
      border-radius: 8px;
      background: white;
      color: #0078d4;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    .btn:hover:not(:disabled) {
      background: #0078d4;
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,120,212,0.3);
    }
    
    .btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-primary {
      width: 100%;
      /* margin-top: auto; */
    }
    
    /* å³ä¾§å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸ */
    .main-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 24px;
      gap: 20px;
      /* ç¡®ä¿ä¸»åŒºåŸŸä¸äº§ç”Ÿæ»šåŠ¨ */
      min-height: 0;
      overflow: hidden;
    }
    
    .image-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      overflow: hidden;
      position: relative;
      /* å…³é”®ï¼šé™åˆ¶å®¹å™¨é«˜åº¦ï¼Œç¡®ä¿å†…å®¹é€‚åº” */
      min-height: 0;
      max-height: 100%;
    }
    
    #mainImage {
      /* å…³é”®ä¿®æ”¹ï¼šç¡®ä¿å›¾ç‰‡å§‹ç»ˆé€‚åº”å®¹å™¨ */
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 8px;
    }
    
    .loading {
      position: absolute;
      font-size: 18px;
      color: #0078d4;
      display: none;
    }
    
    /* æŒ‰é’®ç»„ */
    .button-group {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      /* æŒ‰é’®ç»„å›ºå®šé«˜åº¦ï¼Œä¸å ç”¨è¿‡å¤šç©ºé—´ */
      flex-shrink: 0;
    }
    
    /* æ¨¡æ€æ¡† */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      padding: 32px;
      border-radius: 12px;
      max-width: 500px;
      margin: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    .modal-content p {
      line-height: 1.6;
      color: #333;
      margin-bottom: 24px;
    }
    
    .modal-content a {
      color: #0078d4;
      text-decoration: none;
    }
    
    .modal-content a:hover {
      text-decoration: underline;
    }
    
    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    /* æ¨ªå±ä¼˜åŒ– */
    @media (orientation: landscape) {
      body {
        /* æ¨ªå±æ—¶ç¡®ä¿å®Œå…¨æ— æ»šåŠ¨ */
        overflow-y: hidden;
      }
      
      .main-area {
        /* æ¨ªå±æ—¶å‡å°‘å†…è¾¹è·ï¼Œä¸ºå›¾ç‰‡è…¾å‡ºæ›´å¤šç©ºé—´ */
        padding: 16px;
        gap: 16px;
      }
      
      .image-container {
        /* æ¨ªå±æ—¶å›¾ç‰‡å®¹å™¨æ›´ç´§å‡‘ */
        min-height: 0;
        max-height: calc(100vh - 120px);
      }
      
      .button-group {
        /* æ¨ªå±æ—¶æŒ‰é’®ç»„æ›´ç´§å‡‘ */
        padding-top: 8px;
      }
    }
    
    /* å“åº”å¼è®¾è®¡ - å·²æ›´æ–° */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
        height: 100%;
        min-height: 100vh;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        overscroll-behavior-y: none;
        /* ç§»åŠ¨ç«¯ä¹Ÿç¦æ­¢æ»šåŠ¨ */
        overflow-y: hidden;
      }
    
      .sidebar {
        width: 100%;
        max-height: 40vh;
        height: auto;
        min-height: 240px;
        flex-shrink: 0;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }
    
      .main-area {
        flex: 1;
        min-height: 0;
        max-height: 60vh;
        padding: 16px;
        gap: 16px;
        overflow: hidden;
      }
      
      .image-container {
        max-height: 100%;
        min-height: 0;
      }
    
      .button-group {
        flex-direction: column;
        flex-shrink: 0;
        padding-top: 8px;
      }
    
      .btn {
        width: 100%;
      }
    
      /* é˜²æ­¢selectå…ƒç´ è§¦å‘è§†å£è°ƒæ•´ */
      select {
        touch-action: manipulation;
        font-size: 16px;
      }
    
      select:focus {
        position: relative;
        z-index: 1;
      }
      
      /* ç§»åŠ¨ç«¯æ¨ªå±ç‰¹æ®Šå¤„ç† */
      @media (orientation: landscape) and (max-width: 768px) {
        body {
          flex-direction: row;
        }
        
        .sidebar {
          max-height: 100vh;
          width: 280px;
          min-height: auto;
        }
        
        .main-area {
          max-height: 100vh;
          padding: 16px;
        }
        
        .image-container {
          max-height: calc(100vh - 100px);
        }
      }
    }
    
    /* é’ˆå¯¹å°å±å¹•æ‰‹æœºçš„ä¼˜åŒ– */
    @media (max-width: 480px) {
      body {
        position: fixed;
        height: 100%;
        width: 100%;
      }
    
      .sidebar {
        padding: 16px;
        gap: 16px;
        min-height: 220px;
        max-height: 35vh;
      }
      
      .main-area {
        padding: 12px;
        gap: 12px;
        max-height: 65vh;
      }
      
      .sidebar h1 {
        font-size: 20px;
      }
      
      select {
        padding: 8px 30px 8px 10px;
        font-size: 16px;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 14px;
      }
      
      /* å°å±å¹•æ¨ªå± */
      @media (orientation: landscape) and (max-width: 480px) {
        .sidebar {
          max-height: 100vh;
          min-height: auto;
          width: 250px;
        }
        
        .main-area {
          max-height: 100vh;
        }
        
        .image-container {
          max-height: calc(100vh - 80px);
        }
      }
    }
  </style>
</head>
<body>
  <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
  <aside class="sidebar">
    <h1>ğŸ¨ Random Image</h1>
    <label>Category</label>
    <ul class="select-list" id="categoryList"></ul>
    <button class="btn btn-primary" id="loadBtn">Load New Image</button>
  </aside>

  <!-- å³ä¾§ä¸»æ˜¾ç¤ºåŒºåŸŸ -->
  <main class="main-area">
    <div class="image-container">
      <div class="loading" id="loading">Loading...</div>
      <img id="mainImage" src="" alt="Random Image" style="display: none;">
    </div>
    
    <div class="button-group">
      <button class="btn" id="copyBtn" disabled>Copy Image</button>
      <button class="btn" id="helpBtn">Help</button>
      <button class="btn" id="disclaimerBtn">Disclaimer</button>
    </div>
  </main>

  <script>
    // ==================== é…ç½® ====================
    const CONFIG = {
      apiBase: 'https://hefollo.com/apis.php?type=',
      disclaimer: `
        All content is sourced exclusively from <a href="https://hefollo.com" target="_blank">https://hefollo.com</a>. 
        MOFOM Inc, CA bears no legal or operational responsibility for any disputes arising from said content. 
        In cases involving copyright infringement or other concerns, please contact the operator of hefollo.com 
        via the designated email address: hefollos@gmail.com. Do you agree?
      `,
      categories: [
        {
          name: "Anime Wallpaper (Phone)",
          key: "æ‰‹æœºç«¯-åŠ¨æ¼«å›¾ç‰‡",
          children: [
            { name: "Anime Part 1", key: "åŠ¨æ¼«å›¾ç‰‡1åˆ†åŒº" },
            { name: "Anime Part 2", key: "åŠ¨æ¼«å›¾ç‰‡2åˆ†åŒº" },
            { name: "Anime Part 3", key: "åŠ¨æ¼«å›¾ç‰‡3åˆ†åŒº" }
          ]
        },
        {
          name: "Profile Pictures",
          key: "å¤´åƒ",
          children: [
            {
              name: "Girls",
              key: "å¥³å¤´",
              children: [
                { name: "Girls Part 1", key: "å¥³å¤´å›¾ç‰‡1åˆ†åŒº" }
              ]
            }
          ]
        },
        {
          name: "Photo Sets",
          key: "å¦¹å­å¥—å›¾",
          children: [
            { name: "Lolicon", key: "å†™çœŸ-èè‰è‡ªæ‹" },
            { name: "Part 2", key: "ç²‰è‰²è‰è“å’Œåˆ¶æœé»‘ä¸" }
          ]
        },
        {
          name: "Cities",
          key: "æ‰‹æœºç«¯-åŸå¸‚å›¾ç‰‡",
          children: [
            { name: "Cities Part 1", key: "åŸå¸‚å›¾ç‰‡1åˆ†åŒº" },
            { name: "Cities Part 2", key: "åŸå¸‚å›¾ç‰‡2åˆ†åŒº" },
            { name: "Cities Part 3", key: "åŸå¸‚å›¾ç‰‡3åˆ†åŒº" },
            { name: "Cities Part 4", key: "åŸå¸‚å›¾ç‰‡4åˆ†åŒº" }
          ]
        }
      ]
    };

        // ==================== çŠ¶æ€ç®¡ç† ====================
        const state = {
          currentApiUrl: '',
          isLoading: false
        };
    
        // ==================== DOM å…ƒç´  ====================
        const elements = {
          categoryList: document.getElementById('categoryList'),
          mainImage: document.getElementById('mainImage'),
          loading: document.getElementById('loading'),
          loadBtn: document.getElementById('loadBtn'),
          copyBtn: document.getElementById('copyBtn'),
          helpBtn: document.getElementById('helpBtn'),
          disclaimerBtn: document.getElementById('disclaimerBtn')
        };
    
        // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
    
        // é€’å½’æ¸²æŸ“åˆ†ç±»é€‰æ‹©å™¨
        function renderCategorySelect(categories, level = 0, selectedKey = '') {
          if (!categories || categories.length === 0) return '';
          
          const selectId = `select_level_${level}`;
          let options = '';
          
          // ä¸ºå½“å‰çº§åˆ«çš„æ‰€æœ‰åˆ†ç±»ç”Ÿæˆé€‰é¡¹
          categories.forEach(cat => {
            const selected = selectedKey === cat.key ? 'selected' : '';
            options += `<option value="${cat.key}" ${selected}>${cat.name}</option>`;
          });
          
          return `
            <li>
              <select id="${selectId}" data-level="${level}">
                ${options}
              </select>
            </li>
          `;
        }
    
        // æ ¹æ® key æŸ¥æ‰¾åˆ†ç±»
        function findCategory(categories, key) {
          for (const cat of categories) {
            if (cat.key === key) return cat;
            if (cat.children) {
              const found = findCategory(cat.children, key);
              if (found) return found;
            }
          }
          return null;
        }
    
        // æ ¹æ® key è·¯å¾„æŸ¥æ‰¾åˆ†ç±»æ ‘
        function findCategoryByPath(keys) {
          let current = CONFIG.categories;
          const path = [];
          
          for (const key of keys) {
            const category = current.find(cat => cat.key === key);
            if (!category) break;
            
            path.push(category);
            current = category.children || [];
          }
          
          return path;
        }
    
        // æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨æ˜¾ç¤º
        function updateCategorySelectors(selectedPath = []) {
          elements.categoryList.innerHTML = '';
          let currentCategories = CONFIG.categories;
          let currentPath = [];
          
          // æ¸²æŸ“æ‰€æœ‰çº§åˆ«çš„é€‰æ‹©å™¨
          for (let level = 0; level < selectedPath.length || currentCategories.length > 0; level++) {
            const selectedKey = selectedPath[level] || '';
            const selectedCategory = currentCategories.find(cat => cat.key === selectedKey) || currentCategories[0];
            const actualSelectedKey = selectedCategory ? selectedCategory.key : '';
            
            // æ¸²æŸ“å½“å‰çº§åˆ«çš„é€‰æ‹©å™¨
            elements.categoryList.innerHTML += renderCategorySelect(currentCategories, level, actualSelectedKey);
            
            // å‡†å¤‡ä¸‹ä¸€çº§åˆ†ç±»
            if (selectedCategory && selectedCategory.children) {
              currentCategories = selectedCategory.children;
              currentPath.push(actualSelectedKey);
            } else {
              break;
            }
          }
          
          // ç»‘å®šäº‹ä»¶
          bindCategoryEvents();
          updateApiUrl();
        }
    
        // ç»‘å®šåˆ†ç±»é€‰æ‹©å™¨äº‹ä»¶
        function bindCategoryEvents() {
          const selects = elements.categoryList.querySelectorAll('select');
          
          selects.forEach((select, index) => {
            // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨
            select.replaceWith(select.cloneNode(true));
            
            // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
            const newSelect = elements.categoryList.querySelectorAll('select')[index];
            newSelect.addEventListener('change', handleCategoryChange);
          });
        }
    
        // å¤„ç†åˆ†ç±»å˜åŒ–
        function handleCategoryChange(e) {
          const changedSelect = e.target;
          const level = parseInt(changedSelect.dataset.level);
          const selectedKey = changedSelect.value;
          
          // è·å–å½“å‰é€‰æ‹©çš„è·¯å¾„
          const selects = elements.categoryList.querySelectorAll('select');
          const currentPath = Array.from(selects)
            .slice(0, level + 1)
            .map(select => select.value);
          
          // é‡æ–°æ¸²æŸ“é€‰æ‹©å™¨
          updateCategorySelectors(currentPath);
        }
    
        // æ›´æ–° API URL
        function updateApiUrl() {
          const selects = elements.categoryList.querySelectorAll('select');
          const keys = Array.from(selects).map(s => s.value);
          state.currentApiUrl = CONFIG.apiBase + keys.join('/');
          console.log('API URL:', state.currentApiUrl);
        }
    
        // åˆå§‹åŒ–åˆ†ç±»é€‰æ‹©å™¨
        function initCategories() {
          // è®¾ç½®é»˜è®¤é€‰æ‹©è·¯å¾„ï¼ˆç¬¬ä¸€ä¸ªåˆ†ç±»çš„å®Œæ•´è·¯å¾„ï¼‰
          const defaultPath = getDefaultCategoryPath();
          updateCategorySelectors(defaultPath);
        }
    
        // è·å–é»˜è®¤åˆ†ç±»è·¯å¾„
        function getDefaultCategoryPath() {
          const path = [];
          let current = CONFIG.categories[0]; // ä»ç¬¬ä¸€ä¸ªåˆ†ç±»å¼€å§‹
          
          while (current) {
            path.push(current.key);
            current = current.children && current.children[0] ? current.children[0] : null;
          }
          
          return path;
        }
    
        // è®¾ç½®åŠ è½½çŠ¶æ€
        function setLoading(isLoading) {
          state.isLoading = isLoading;
          elements.loading.style.display = isLoading ? 'block' : 'none';
          elements.mainImage.style.display = isLoading ? 'none' : 'block';
          elements.loadBtn.disabled = isLoading;
          elements.copyBtn.disabled = isLoading || !elements.mainImage.src;
          
          if (isLoading) {
            elements.loadBtn.textContent = 'Loading...';
          } else {
            elements.loadBtn.textContent = 'Load New Image';
          }
        }
    
        // åŠ è½½å›¾ç‰‡
        function loadImage() {
          if (!state.currentApiUrl) {
            alert('Please select a category first.');
            return;
          }
    
          setLoading(true);
          const url = state.currentApiUrl + '&t=' + Date.now();
    
          elements.mainImage.onload = () => {
            setLoading(false);
            console.log('Image loaded successfully');
          };
    
          elements.mainImage.onerror = () => {
            setLoading(false);
            alert('Failed to load image. Please try again.');
          };
    
          elements.mainImage.src = url;
        }
    
        // å¤åˆ¶å›¾ç‰‡åˆ°å‰ªè´´æ¿
        async function copyImage() {
          if (!elements.mainImage.src) {
            alert('No image to copy. Please load an image first.');
            return;
          }
    
          const originalText = elements.copyBtn.textContent;
          elements.copyBtn.disabled = true;
          elements.copyBtn.textContent = 'Copying...';
    
          try {
            // åˆ›å»ºéšè—çš„å¯ç¼–è¾‘å®¹å™¨
            const container = document.createElement('div');
            container.contentEditable = true;
            container.style.position = 'fixed';
            container.style.left = '-9999px';
            container.style.opacity = '0';
            document.body.appendChild(container);
    
            // å…‹éš†å›¾ç‰‡åˆ°å®¹å™¨
            const imgClone = elements.mainImage.cloneNode(true);
            imgClone.style.maxWidth = 'none';
            imgClone.style.maxHeight = 'none';
            container.appendChild(imgClone);
    
            // é€‰ä¸­å›¾ç‰‡
            const range = document.createRange();
            range.selectNode(imgClone);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
    
            // æ‰§è¡Œå¤åˆ¶
            const success = document.execCommand('copy');
    
            // æ¸…ç†
            selection.removeAllRanges();
            document.body.removeChild(container);
    
            if (success) {
              elements.copyBtn.textContent = 'âœ“ Copied!';
              setTimeout(() => {
                elements.copyBtn.textContent = originalText;
                elements.copyBtn.disabled = false;
              }, 2000);
              console.log('Image copied successfully');
            } else {
              throw new Error('Copy command failed');
            }
          } catch (error) {
            console.error('Copy failed:', error);
            alert('Failed to copy image. Please right-click the image and select "Copy Image".');
            elements.copyBtn.textContent = originalText;
            elements.copyBtn.disabled = false;
          }
        }
    
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(message, onConfirm, onCancel) {
          const modal = document.createElement('div');
          modal.className = 'modal';
          modal.innerHTML = `
            <div class="modal-content">
              <p>${message}</p>
              <div class="modal-buttons">
                <button class="btn" id="modalYes">Yes, I Agree</button>
                <button class="btn" id="modalNo">No</button>
              </div>
            </div>
          `;
    
          document.body.appendChild(modal);
    
          modal.querySelector('#modalYes').addEventListener('click', () => {
            document.body.removeChild(modal);
            if (onConfirm) onConfirm();
          });
    
          modal.querySelector('#modalNo').addEventListener('click', () => {
            document.body.removeChild(modal);
            if (onCancel) onCancel();
          });
        }
    
        // ==================== äº‹ä»¶ç»‘å®š ====================
        elements.loadBtn.addEventListener('click', loadImage);
        elements.copyBtn.addEventListener('click', copyImage);
        elements.helpBtn.addEventListener('click', () => {
          window.open('https://mofom.net/mofomvideo/help', '_blank');
        });
        elements.disclaimerBtn.addEventListener('click', () => {
          showModal(CONFIG.disclaimer, 
            () => loadImage(),
            () => window.location.href = 'https://mofom.net'
          );
        });
    
        // ==================== åˆå§‹åŒ– ====================
        initCategories();
        
        // æ˜¾ç¤ºå…è´£å£°æ˜
        setTimeout(() => {
          showModal(CONFIG.disclaimer, 
            () => loadImage(),
            () => window.location.href = 'https://mofom.net'
          );
        }, 500);
  </script>
</body>
</html>